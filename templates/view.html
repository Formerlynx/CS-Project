{% extends "base.html" %}

{% block title %}View Expenses - Expense Tracker{% endblock %}

{% block content %}
<h1 class="mb-4">View Expenses</h1>
<table class="table table-bordered table-striped">
    <thead class="table-light">
        <tr>
            <th>Date</th>
            <th>Category</th>
            <th>Amount</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody id="expenses-table" class="bg-dark text-white">
        {% for expense in expenses %}
        <tr id="expense-{{ expense.id }}" class="bg-dark text-white">
            <td class="bg-dark text-white">{{ expense.date }}</td>
            <td class="bg-dark text-white">{{ expense.category }}</td>
            <td class="bg-dark text-white">{{ "%.3f"|format(expense.amount) }}</td>
            <td class="bg-dark text-white">
                <a href="{{ url_for('edit_expense', expense_id=expense.id) }}" class="btn btn-sm btn-primary">Edit</a>
                <button class="btn btn-sm btn-danger delete-button" data-id="{{ expense.id }}">Delete</button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const deleteButtons = document.querySelectorAll('.delete-button');

        deleteButtons.forEach(button => {
            button.addEventListener('click', async (event) => {
                const expenseId = event.target.getAttribute('data-id');
                const confirmDelete = confirm('Are you sure you want to delete this expense?');

                if (confirmDelete) {
                    try {
                        const response = await fetch(`/delete/${expenseId}`, {
                            method: 'DELETE',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        });

                        if (response.ok) {
                            const row = document.getElementById(`expense-${expenseId}`);
                            row.remove();
                            alert('Expense deleted successfully!');
                        } else {
                            alert('Failed to delete the expense. Please try again.');
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        alert('An error occurred. Please try again.');
                    }
                }
            });
        });
    });
</script>
{% endblock %}
